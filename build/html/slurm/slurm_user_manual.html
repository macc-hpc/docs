
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Using Slurm &#8212; MaccDocs  documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../',
        VERSION:     '',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Environments" href="../virtual_environments/index.html" />
    <link rel="prev" title="Slurm Quick Start Guide" href="slurm_quick_start_guide.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="using-slurm">
<h1>Using Slurm<a class="headerlink" href="#using-slurm" title="Permalink to this headline">¶</a></h1>
<p>In order to understand how Slurm is used in practice, we will present a practical case and then explain how we can use Slurm for its execution, as well as managing its life cycle.</p>
<p>Now that everything is ready, the next step is to use Slurm to execute your job.</p>
<div class="section" id="before-starting">
<h2>Before starting<a class="headerlink" href="#before-starting" title="Permalink to this headline">¶</a></h2>
<p>Before submitting a job is important to have a general overview of the cluster. For instance, it is important to know the resources offered by the cluster and which jobs are currently allocating them.</p>
<p>For this purpose, the <em>sinfo</em> command can be used to get a overview of the resources offered by the cluster, while the <em>squeue</em> command shows which jobs are the resources allocated to.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sinfo
PARTITION AVAIL  TIMELIMIT  NODES  STATE NODELIST
base*        up <span class="m">2</span>-00:00:00      <span class="m">2</span> drain* c806
base*        up <span class="m">2</span>-00:00:00    <span class="m">154</span>  down* c805
longrun      up <span class="m">6</span>-00:00:00     <span class="m">33</span>  alloc c823
longrun      up <span class="m">6</span>-00:00:00      <span class="m">5</span>   idle c824
</pre></div>
</div>
<p>The above command shows the output of a <em>sinfo</em> execution, showing some info about the cluster. In the first column, we see the available queues on the cluster, being in this case, <em>base</em> and <em>longrun</em>. Usually each of this partitions are used for different purposes. As we can see in the example, the base partition (default) is used for faster jobs, allowing at most 48 hours of execution time. In case the users need to run jobs for longer than that, they can use the <em>longrun</em> partition which support jobs running at most for 144 hours (6 days).</p>
<p>It is also useful so check the queues to see which jobs are already running, their size and how much time you will have to wait until your job starts executing.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ squeue
JOBID PARTITION     NAME   USER  ST       TIME   NODES NODELIST<span class="o">(</span>REASON<span class="o">)</span>
<span class="m">6969</span>   longrun      jobW   userA  R     <span class="m">23</span>:59:05   <span class="m">16</span>   c823
<span class="m">6970</span>   longrun      jobX   userB  R      <span class="m">5</span>:02:27   <span class="m">16</span>   c825
<span class="m">7004</span>   base         jobY   userC  R   <span class="m">1</span>-23:00:01   <span class="m">1</span>    c806
<span class="m">7005</span>   base         jobZ   userD  PD      <span class="m">0</span>:00     <span class="m">32</span>   c812
</pre></div>
</div>
<p>Here, we can see which jobs are running, with the state <em>R</em>, short for running, and which are waiting for resources <em>PD</em>, short for pending.</p>
</div>
<div class="section" id="creating-a-job">
<h2>Creating a job<a class="headerlink" href="#creating-a-job" title="Permalink to this headline">¶</a></h2>
<p>The first thing to know before creating a job is that it is composed by two parts: jobs steps and resources. Job steps are tasks by which the main job is composed, while resources consist in amounts of CPU, RAM, disk space and computing time.</p>
<p>The most common way to create a job is to write a shell script. For example, in the script below is a simple job where one CPU is requested for one minute along with 100MB of RAM for the job execution. The directives <em>SBATCH</em> must appear before the script begins, between the shebang and the script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#</span>
<span class="c1">#SBATCH --job-name=JobA</span>
<span class="c1">#SBATCH --output=hello.txt</span>
<span class="c1">#</span>
<span class="c1">#SBATCH --ntasks=1</span>
<span class="c1">#SBATCH --time=01:00</span>
<span class="c1">#SBATCH --mem-per-cpu=100</span>

srun <span class="nb">echo</span> <span class="s2">&quot;Hello Bob!&quot;</span>
</pre></div>
</div>
<p>In order to submit a shell script for execution we can use the <em>sbatch</em> command, which will respond with the <em>jobid</em> attributed to the job. Once the resources become available and the job has the highest priority, an allocation is made for it so it can run. Typically, a shell script has multiple <em>srun</em> commands, who are responsible for launching the parallel jobs.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sbatch script.sh
Submitted batch job <span class="m">7880</span>
</pre></div>
</div>
</div>
<div class="section" id="job-information">
<h2>Job information<a class="headerlink" href="#job-information" title="Permalink to this headline">¶</a></h2>
<p>Once the jobs are created we can check their state with:</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ sacct
       JobID    JobName  Partition    Account  AllocCPUS      State ExitCode
------------ ---------- ---------- ---------- ---------- ---------- --------
<span class="m">7880</span>               JobA       base                     <span class="m">1</span>    PENDING      <span class="m">0</span>:0
</pre></div>
</div>
<p>This command only displays the jobs submitted by the user and not a global view of the submitted jobs on the cluster.</p>
</div>
<div class="section" id="job-cancel">
<h2>Job cancel<a class="headerlink" href="#job-cancel" title="Permalink to this headline">¶</a></h2>
<p>A user can also cancel a pending or running job, passing the <em>jobid</em> to the <em>scancel</em> command.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>$ scancel JobID
</pre></div>
</div>
</div>
<div class="section" id="job-arrays">
<h2>Job arrays<a class="headerlink" href="#job-arrays" title="Permalink to this headline">¶</a></h2>
<p>What if you have an application that needs to be executed five times, each with different input parameters? Instead of creating five individual Slurm scripts you can use job arrays. Job array is a collection of jobs that lets you run similar jobs easily. In order to create a job array, we can use a single Slurm script and use the –array flag to specify a range for the index parameter.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span>sbatch --array &lt;indexlist&gt;<span class="o">[</span>%&lt;limit&gt;<span class="o">]</span> script.sh
</pre></div>
</div>
<p>You can either specify the range index on the <em>sbatch</em> command or on the bash script.</p>
<div class="highlight-bash"><div class="highlight"><pre><span></span><span class="ch">#!/bin/bash</span>
<span class="c1">#SBATCH --job-name=myJobarrayTest</span>
<span class="c1">#SBATCH --nodes=1 --ntasks=1</span>
<span class="c1">#SBATCH --time=5:00</span>
<span class="c1">#SBATCH --output=test_%A_%a.out</span>
<span class="c1">#SBATCH --error=test_%A_%a.err</span>
<span class="c1">#SBATCH --partition sixhour</span>
<span class="c1">#SBATCH --array=1-5</span>
<span class="nb">echo</span> <span class="s2">&quot;</span><span class="nv">$SLURM_ARRAY_TASK_ID</span><span class="s2">&quot;</span>
</pre></div>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<h3><a href="../index.html">Table Of Contents</a></h3>
<p class="caption"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../registration/index.html">Registration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../connection/index.html">Connection</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Using Slurm</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="index.html#overview">Overview</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="slurm_quick_start_guide.html">Slurm Quick Start Guide</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Using Slurm</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#before-starting">Before starting</a></li>
<li class="toctree-l4"><a class="reference internal" href="#creating-a-job">Creating a job</a></li>
<li class="toctree-l4"><a class="reference internal" href="#job-information">Job information</a></li>
<li class="toctree-l4"><a class="reference internal" href="#job-cancel">Job cancel</a></li>
<li class="toctree-l4"><a class="reference internal" href="#job-arrays">Job arrays</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../virtual_environments/index.html">Environments</a></li>
<li class="toctree-l1"><a class="reference internal" href="../support/index.html">Support</a></li>
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Using Slurm</a><ul>
      <li>Previous: <a href="slurm_quick_start_guide.html" title="previous chapter">Slurm Quick Start Guide</a></li>
      <li>Next: <a href="../virtual_environments/index.html" title="next chapter">Environments</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
  <div role="note" aria-label="source link">
    <h3>This Page</h3>
    <ul class="this-page-menu">
      <li><a href="../_sources/slurm/slurm_user_manual.md.txt"
            rel="nofollow">Show Source</a></li>
    </ul>
   </div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2019, Daniel Cruz.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.6.7</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="../_sources/slurm/slurm_user_manual.md.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>